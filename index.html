<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
    <title>API Key ÊµãÊ¥ªÂ∑•ÂÖ∑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ÊöóËâ≤‰∏ªÈ¢òÊ†∑Âºè */
        .dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }

        .dark-theme .container {
            background: linear-gradient(135deg, #232741 0%, #1e1e2e 100%);
            color: #e8eaed;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .dark-theme .header {
            background: linear-gradient(135deg, #232741 0%, #1e1e2e 100%);
        }

        .dark-theme .input-section {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .input-section:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
            box-shadow: 0 4px 20px rgba(76, 99, 210, 0.15);
        }

        .dark-theme .form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #e8eaed;
            border-color: #3c4269;
        }

        .dark-theme .form-control:focus {
            border-color: #4c63d2;
            box-shadow: 0 0 0 3px rgba(76, 99, 210, 0.1);
        }

        .dark-theme .form-control:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #252849 0%, #2a2d47 100%);
        }

        .dark-theme select.form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #e8eaed;
        }

        .dark-theme select.form-control option {
            background: #232741;
            color: #e8eaed;
        }

        .dark-theme input.form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #e8eaed;
        }

        .dark-theme textarea.form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #e8eaed;
        }

        .dark-theme .stat-card {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .stat-card:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(76, 99, 210, 0.2);
        }

        .dark-theme .key-list {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .key-list:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
            box-shadow: 0 2px 12px rgba(76, 99, 210, 0.15);
        }

        .dark-theme .empty-state {
            color: #b0b3c1;
        }

        .dark-theme .empty-icon {
            opacity: 0.5;
        }

        .dark-theme .empty-text {
            opacity: 0.7;
        }

        .dark-theme .key-item {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .key-item:hover {
            background: linear-gradient(135deg, #2a2d47 0%, #1e1e2e 100%);
            border-color: #4c63d2;
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(76, 99, 210, 0.15);
        }

        .dark-theme .tab {
            color: #b0b3c1;
        }

        .dark-theme .tab.active {
            color: #4c63d2;
        }

        .dark-theme .alert {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
            color: #e8eaed;
        }

        .dark-theme .alert:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
            box-shadow: 0 2px 12px rgba(76, 99, 210, 0.2);
        }

        .dark-theme .btn-secondary {
            background: linear-gradient(135deg, #3c4269 0%, #2a2d47 100%);
        }

        .dark-theme .btn-secondary:hover {
            background: linear-gradient(135deg, #4a5079 0%, #3c4269 100%);
        }

        .dark-theme .form-help {
            color: #b0b3c1;
        }

        .dark-theme .stat-label {
            color: #b0b3c1;
        }

        .dark-theme .input-group label {
            color: #e8eaed;
        }

        .dark-theme .detected-models {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .detected-models:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
            box-shadow: 0 2px 12px rgba(76, 99, 210, 0.2);
        }

        .dark-theme .detected-models-header {
            border-bottom-color: #3c4269;
        }

        .dark-theme .detected-models-header:hover {
            background: rgba(76, 99, 210, 0.1);
        }

        .dark-theme .detected-models-header h4 {
            color: #4c63d2;
        }

        .dark-theme .collapse-icon {
            color: #4c63d2;
        }

        .dark-theme .model-tag {
            background: #4c63d2;
        }

        .dark-theme .model-tag:hover {
            background: #3c52d2;
        }

        .dark-theme .model-toggle-btn {
            background: #3c4269;
        }

        .dark-theme .model-toggle-btn:hover {
            background: #4a5079;
        }

        .dark-theme .model-toggle-btn.active {
            background: #4c63d2;
        }

        .dark-theme .concurrency-container {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .concurrency-container:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
        }

        .dark-theme .concurrency-input-section .form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #4c63d2;
            border-color: #3c4269;
        }

        .dark-theme .concurrency-input-section .form-control:focus {
            border-color: #4c63d2;
            box-shadow: 0 0 0 3px rgba(76, 99, 210, 0.1);
        }

        .dark-theme .slider {
            background: #3c4269;
        }

        .dark-theme .slider::-webkit-slider-thumb {
            background: #4c63d2;
        }

        .dark-theme .slider::-webkit-slider-thumb:hover {
            background: #3c52d2;
        }

        .dark-theme .slider::-moz-range-thumb {
            background: #4c63d2;
        }

        .dark-theme .slider-value {
            color: #4c63d2;
            background: #232741;
            border-color: #3c4269;
        }

        .dark-theme .preset-btn {
            border-color: #4c63d2;
            color: #4c63d2;
            background: #232741;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .dark-theme .preset-btn:hover {
            background: #4c63d2;
            color: white;
            box-shadow: 0 4px 12px rgba(76, 99, 210, 0.3);
        }

        .dark-theme .preset-btn.active {
            background: #4c63d2;
            color: white;
            box-shadow: 0 4px 12px rgba(76, 99, 210, 0.4);
        }

        /* Ê∑±Ëâ≤‰∏ªÈ¢òÈáçËØïÁõ∏ÂÖ≥Ê†∑Âºè */
        .dark-theme .retry-container {
            background: linear-gradient(135deg, #3d3314 0%, #2d2a1a 100%);
            border-color: #5d4e23;
        }

        .dark-theme .retry-container:hover {
            border-color: #d68910;
            background: linear-gradient(135deg, #4d4024 0%, #3d3314 100%);
        }

        .dark-theme .retry-input-section .form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #d68910;
            border-color: #5d4e23;
        }

        .dark-theme .retry-input-section .form-control:focus {
            border-color: #d68910;
            box-shadow: 0 0 0 3px rgba(214, 137, 16, 0.1);
        }

        .dark-theme .retry-slider {
            background: #5d4e23;
        }

        .dark-theme .retry-slider::-webkit-slider-thumb {
            background: #d68910;
        }

        .dark-theme .retry-slider::-webkit-slider-thumb:hover {
            background: #b7791f;
        }

        .dark-theme .retry-slider::-moz-range-thumb {
            background: #d68910;
        }

        .dark-theme .retry-slider-value {
            color: #d68910;
            background: #232741;
            border-color: #5d4e23;
        }

        .dark-theme .retry-preset-btn {
            border-color: #d68910;
            color: #d68910;
            background: #232741;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .dark-theme .retry-preset-btn:hover {
            background: #d68910;
            color: white;
            box-shadow: 0 4px 12px rgba(214, 137, 16, 0.3);
        }

        .dark-theme .retry-preset-btn.active {
            background: #d68910;
            color: white;
            box-shadow: 0 4px 12px rgba(214, 137, 16, 0.4);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            margin-bottom: 8px;
            font-weight: 700;
            word-break: break-word;
        }
        
        .header p {
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            opacity: 0.9;
            line-height: 1.4;
        }
        
        .main-content {
            padding: 20px;
        }
        
        .input-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .input-section:hover {
            border-color: #667eea;
            background: #f0f4ff;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.1);
        }
        
        .input-group {
            margin-bottom: 16px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #495057;
            font-size: clamp(0.9rem, 2vw, 1rem);
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: clamp(14px, 2.5vw, 16px);
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-control:hover {
            border-color: #667eea;
            background: #fafbff;
        }
        
        .form-control.textarea {
            resize: vertical;
            min-height: 100px;
            font-family: 'Courier New', monospace;
            font-size: clamp(12px, 2vw, 14px);
        }
        
        .form-help {
            color: #6c757d;
            font-size: clamp(10px, 1.8vw, 12px);
            margin-top: 4px;
            display: block;
            line-height: 1.3;
        }

        .model-input-group {
            display: flex;
            gap: 8px;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .model-input-group .form-control {
            flex: 1;
            min-width: 0;
        }

        .model-toggle-btn {
            padding: 12px 12px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(12px, 2vw, 14px);
            white-space: nowrap;
            transition: background 0.3s ease;
            flex-shrink: 0;
        }

        .model-toggle-btn:hover {
            background: #5a6268;
        }

        .model-toggle-btn.active {
            background: #667eea;
        }

        .detected-models {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
            transition: all 0.3s ease;
        }

        .detected-models:hover {
            border-color: #2196f3;
            background: #e1f5fe;
            box-shadow: 0 2px 12px rgba(33, 150, 243, 0.15);
        }

        .detected-models-header {
            padding: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #bbdefb;
            transition: background 0.3s ease;
        }

        .detected-models-header:hover {
            background: rgba(33, 150, 243, 0.1);
        }

        .detected-models-header h4 {
            margin: 0;
            color: #1976d2;
            font-size: clamp(12px, 2vw, 14px);
        }

        .collapse-icon {
            color: #1976d2;
            font-size: 14px;
            transition: transform 0.3s ease;
        }

        .collapse-icon.collapsed {
            transform: rotate(-90deg);
        }

        .model-list-container {
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .model-list-container.expanded {
            display: block;
        }

        .model-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .model-tag {
            background: #2196f3;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: clamp(10px, 1.8vw, 12px);
            cursor: pointer;
            transition: background 0.3s ease;
            word-break: break-all;
        }

        .model-tag:hover {
            background: #1976d2;
        }

        /* Âπ∂ÂèëËÆæÁΩÆÊ†∑Âºè - ÁßªÂä®Á´Ø‰ºòÂåñ */
        .concurrency-container {
            display: flex;
            flex-direction: row;
            gap: 16px;
            align-items: center;
            margin-top: 12px;
            padding: 16px;
            background: #f1f3f5;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .concurrency-container:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .concurrency-input-section {
            flex-shrink: 0;
            min-width: 80px;
        }

        .concurrency-input-section .form-control {
            width: 80px;
            text-align: center;
            font-weight: 600;
            color: #667eea;
            background: white;
            border: 2px solid #dee2e6;
        }

        .concurrency-input-section .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .slider-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #dee2e6;
            outline: none;
            transition: background 0.3s ease;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            transition: background 0.3s ease;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
        }

        .slider::-webkit-slider-thumb:hover {
            background: #5a67d8;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
        }

        .slider-value {
            min-width: 30px;
            text-align: center;
            font-weight: 700;
            color: #667eea;
            font-size: clamp(14px, 2.5vw, 18px);
            background: white;
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            flex-shrink: 0;
        }

        .preset-buttons {
            display: flex;
            gap: 6px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 8px 12px;
            border: 1px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(11px, 2vw, 13px);
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 50px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            flex: 1;
            max-width: 80px;
        }

        .preset-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .preset-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* ÈáçËØïËÆæÁΩÆÊ†∑Âºè */
        .retry-container {
            display: flex;
            flex-direction: row;
            gap: 16px;
            align-items: center;
            margin-top: 12px;
            padding: 16px;
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .retry-container:hover {
            border-color: #f39c12;
            background: #fef9e7;
        }

        .retry-input-section {
            flex-shrink: 0;
            min-width: 80px;
        }

        .retry-input-section .form-control {
            width: 80px;
            text-align: center;
            font-weight: 600;
            color: #f39c12;
            background: white;
            border: 2px solid #ffeaa7;
        }

        .retry-input-section .form-control:focus {
            border-color: #f39c12;
            box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.1);
        }

        .retry-slider-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .retry-slider-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .retry-slider {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #ffeaa7;
            outline: none;
            transition: background 0.3s ease;
        }

        .retry-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #f39c12;
            cursor: pointer;
            transition: background 0.3s ease;
            box-shadow: 0 2px 6px rgba(243, 156, 18, 0.3);
        }

        .retry-slider::-webkit-slider-thumb:hover {
            background: #e67e22;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4);
        }

        .retry-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #f39c12;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(243, 156, 18, 0.3);
        }

        .retry-slider-value {
            min-width: 30px;
            text-align: center;
            font-weight: 700;
            color: #f39c12;
            font-size: clamp(14px, 2.5vw, 18px);
            background: white;
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid #ffeaa7;
            flex-shrink: 0;
        }

        .retry-preset-buttons {
            display: flex;
            gap: 6px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .retry-preset-btn {
            padding: 8px 12px;
            border: 1px solid #f39c12;
            background: white;
            color: #f39c12;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(11px, 2vw, 13px);
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 50px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            flex: 1;
            max-width: 80px;
        }

        .retry-preset-btn:hover {
            background: #f39c12;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }

        .retry-preset-btn.active {
            background: #f39c12;
            color: white;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: clamp(14px, 2.5vw, 16px);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-detect {
            background: #28a745;
            color: white;
        }

        .btn-detect:hover {
            background: #218838;
        }
        
        .results-section {
            margin-top: 20px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 16px 12px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
        }
        
        .stat-number {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
        }
        
        .valid { color: #28a745; }
        .invalid { color: #dc3545; }
        .rate-limited { color: #ffc107; }
        .testing { color: #6f42c1; }
        .retrying { color: #fd7e14; }
        .total { color: #6f42c1; }
        
        .results-tabs {
            display: flex;
            margin-bottom: 16px;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            padding: 10px 16px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: clamp(12px, 2.2vw, 16px);
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .key-list {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 16px;
            max-height: 350px;
            overflow-y: auto;
            transition: all 0.3s ease;
            -webkit-overflow-scrolling: touch;
            min-height: 120px;
            display: flex;
            flex-direction: column;
        }

        .key-list:hover {
            border-color: #667eea;
            background: #f0f4ff;
            box-shadow: 0 2px 12px rgba(102, 126, 234, 0.1);
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            min-height: 80px;
            color: #6c757d;
            text-align: center;
            padding: 20px;
        }

        .empty-icon {
            font-size: 2rem;
            margin-bottom: 8px;
            opacity: 0.6;
        }

        .empty-text {
            font-size: clamp(14px, 2.5vw, 16px);
            font-weight: 500;
            opacity: 0.8;
        }
        
        .key-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            transition: all 0.3s ease;
            flex-wrap: wrap;
            gap: 8px;
        }

        .key-item:hover {
            border-color: #667eea;
            background: #fafbff;
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }
        
        .key-text {
            font-family: 'Courier New', monospace;
            font-size: clamp(11px, 2vw, 14px);
            color: #495057;
            flex: 1;
            margin-right: 8px;
            word-break: break-all;
            line-height: 1.4;
            min-width: 0;
        }
        
        .key-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: clamp(10px, 1.8vw, 12px);
            font-weight: 600;
            text-transform: uppercase;
            flex-shrink: 0;
        }
        
        .status-valid {
            background: #d4edda;
            color: #155724;
        }
        
        .status-invalid {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-rate-limited {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-testing {
            background: #e2e3e5;
            color: #6c757d;
        }

        .status-retrying {
            background: #ffeaa7;
            color: #d68910;
            animation: pulse 1.5s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 0.6; }
            to { opacity: 1; }
        }
        
        .copy-btn {
            padding: 10px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: clamp(12px, 2vw, 14px);
            margin-top: 12px;
            width: 100%;
            transition: background 0.3s ease;
        }
        
        .copy-btn:hover {
            background: #0056b3;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }

        .alert {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            color: #0c5460;
            transition: all 0.3s ease;
            font-size: clamp(12px, 2vw, 14px);
            line-height: 1.4;
        }

        .alert:hover {
            border-color: #17a2b8;
            background: #c3e6ea;
            box-shadow: 0 2px 12px rgba(23, 162, 184, 0.15);
        }

        /* ‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆ */
        .theme-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* ÁßªÂä®Á´ØÁâπÊÆä‰ºòÂåñ */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .container {
                border-radius: 15px;
                margin: 0;
            }
            
            .header {
                padding: 16px;
            }
            
            .main-content {
                padding: 16px;
            }
            
            .input-section {
                padding: 16px;
                margin-bottom: 16px;
            }
            
            .model-input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .model-toggle-btn {
                width: 100%;
                margin-top: 8px;
            }
            
            .concurrency-container, .retry-container {
                flex-direction: column;
                gap: 12px;
                padding: 12px;
                align-items: stretch;
            }
            
            .concurrency-input-section, .retry-input-section {
                align-self: center;
                min-width: auto;
            }
            
            .concurrency-input-section .form-control, .retry-input-section .form-control {
                width: 100px;
                margin: 0 auto;
            }
            
            .slider-section, .retry-slider-section {
                width: 100%;
            }
            
            .preset-buttons, .retry-preset-buttons {
                gap: 4px;
                margin-top: 8px;
            }
            
            .preset-btn, .retry-preset-btn {
                min-width: 60px;
                max-width: none;
                flex: 1;
            }
            
            .button-group {
                flex-direction: column;
                gap: 12px;
            }
            
            .btn {
                min-width: auto;
                width: 100%;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .stat-card {
                padding: 12px 8px;
            }
            
            .results-tabs {
                gap: 4px;
            }
            
            .tab {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .key-list {
                padding: 12px;
                max-height: 300px;
            }
            
            .key-item {
                padding: 10px;
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
            
            .key-text {
                margin-right: 0;
                width: 100%;
            }
            
            .key-status {
                align-self: flex-end;
            }
            
            .theme-controls {
                top: 8px;
                right: 8px;
                gap: 6px;
            }
            
            .control-btn {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            .alert {
                padding: 10px;
                font-size: 12px;
            }
        }

        /* Ê∑±Ëâ≤‰∏ªÈ¢ò */
        .dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }

        .dark-theme .container {
            background: linear-gradient(135deg, #232741 0%, #1e1e2e 100%);
            color: #e8eaed;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .dark-theme .header {
            background: linear-gradient(135deg, #232741 0%, #1e1e2e 100%);
        }

        .dark-theme .input-section {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .input-section:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
            box-shadow: 0 4px 20px rgba(76, 99, 210, 0.15);
        }

        .dark-theme .form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #e8eaed;
            border-color: #3c4269;
        }

        .dark-theme .form-control:focus {
            border-color: #4c63d2;
            box-shadow: 0 0 0 3px rgba(76, 99, 210, 0.1);
        }

        .dark-theme .form-control:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #252849 0%, #2a2d47 100%);
        }

        .dark-theme select.form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #e8eaed;
        }

        .dark-theme select.form-control option {
            background: #232741;
            color: #e8eaed;
        }

        .dark-theme input.form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #e8eaed;
        }

        .dark-theme textarea.form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #e8eaed;
        }

        .dark-theme .form-help {
            color: #b0b3c1;
        }

        .dark-theme .stat-label {
            color: #b0b3c1;
        }

        .dark-theme .input-group label {
            color: #e8eaed;
        }

        .dark-theme .stat-card {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .stat-card:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(76, 99, 210, 0.2);
        }

        .dark-theme .key-list {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .key-list:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
            box-shadow: 0 2px 12px rgba(76, 99, 210, 0.15);
        }

        .dark-theme .empty-state {
            color: #b0b3c1;
        }

        .dark-theme .empty-icon {
            opacity: 0.5;
        }

        .dark-theme .empty-text {
            opacity: 0.7;
        }

        .dark-theme .key-item {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .key-item:hover {
            background: linear-gradient(135deg, #2a2d47 0%, #1e1e2e 100%);
            border-color: #4c63d2;
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(76, 99, 210, 0.15);
        }

        .dark-theme .tab {
            color: #b0b3c1;
        }

        .dark-theme .tab.active {
            color: #4c63d2;
        }

        .dark-theme .results-tabs {
            border-bottom-color: #3c4269;
        }

        .dark-theme .alert {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
            color: #e8eaed;
        }

        .dark-theme .alert:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
            box-shadow: 0 2px 12px rgba(76, 99, 210, 0.2);
        }

        .dark-theme .btn-secondary {
            background: linear-gradient(135deg, #3c4269 0%, #2a2d47 100%);
        }

        .dark-theme .btn-secondary:hover {
            background: linear-gradient(135deg, #4a5079 0%, #3c4269 100%);
        }

        .dark-theme .detected-models {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .detected-models:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
            box-shadow: 0 2px 12px rgba(76, 99, 210, 0.2);
        }

        .dark-theme .detected-models-header {
            border-bottom-color: #3c4269;
        }

        .dark-theme .detected-models-header:hover {
            background: rgba(76, 99, 210, 0.1);
        }

        .dark-theme .detected-models-header h4 {
            color: #4c63d2;
        }

        .dark-theme .collapse-icon {
            color: #4c63d2;
        }

        .dark-theme .model-tag {
            background: #4c63d2;
        }

        .dark-theme .model-tag:hover {
            background: #3c52d2;
        }

        .dark-theme .model-toggle-btn {
            background: #3c4269;
        }

        .dark-theme .model-toggle-btn:hover {
            background: #4a5079;
        }

        .dark-theme .model-toggle-btn.active {
            background: #4c63d2;
        }

        .dark-theme .concurrency-container {
            background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
            border-color: #3c4269;
        }

        .dark-theme .concurrency-container:hover {
            border-color: #4c63d2;
            background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
        }

        .dark-theme .concurrency-input-section .form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #4c63d2;
            border-color: #3c4269;
        }

        .dark-theme .concurrency-input-section .form-control:focus {
            border-color: #4c63d2;
            box-shadow: 0 0 0 3px rgba(76, 99, 210, 0.1);
        }

        .dark-theme .slider {
            background: #3c4269;
        }

        .dark-theme .slider::-webkit-slider-thumb {
            background: #4c63d2;
        }

        .dark-theme .slider::-webkit-slider-thumb:hover {
            background: #3c52d2;
        }

        .dark-theme .slider::-moz-range-thumb {
            background: #4c63d2;
        }

        .dark-theme .slider-value {
            color: #4c63d2;
            background: #232741;
            border-color: #3c4269;
        }

        .dark-theme .preset-btn {
            border-color: #4c63d2;
            color: #4c63d2;
            background: #232741;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .dark-theme .preset-btn:hover {
            background: #4c63d2;
            color: white;
            box-shadow: 0 4px 12px rgba(76, 99, 210, 0.3);
        }

        .dark-theme .preset-btn.active {
            background: #4c63d2;
            color: white;
            box-shadow: 0 4px 12px rgba(76, 99, 210, 0.4);
        }

        /* Ê∑±Ëâ≤‰∏ªÈ¢òÈáçËØïÁõ∏ÂÖ≥Ê†∑Âºè */
        .dark-theme .retry-container {
            background: linear-gradient(135deg, #3d3314 0%, #2d2a1a 100%);
            border-color: #5d4e23;
        }

        .dark-theme .retry-container:hover {
            border-color: #d68910;
            background: linear-gradient(135deg, #4d4024 0%, #3d3314 100%);
        }

        .dark-theme .retry-input-section .form-control {
            background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
            color: #d68910;
            border-color: #5d4e23;
        }

        .dark-theme .retry-input-section .form-control:focus {
            border-color: #d68910;
            box-shadow: 0 0 0 3px rgba(214, 137, 16, 0.1);
        }

        .dark-theme .retry-slider {
            background: #5d4e23;
        }

        .dark-theme .retry-slider::-webkit-slider-thumb {
            background: #d68910;
        }

        .dark-theme .retry-slider::-webkit-slider-thumb:hover {
            background: #b7791f;
        }

        .dark-theme .retry-slider::-moz-range-thumb {
            background: #d68910;
        }

        .dark-theme .retry-slider-value {
            color: #d68910;
            background: #232741;
            border-color: #5d4e23;
        }

        .dark-theme .retry-preset-btn {
            border-color: #d68910;
            color: #d68910;
            background: #232741;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .dark-theme .retry-preset-btn:hover {
            background: #d68910;
            color: white;
            box-shadow: 0 4px 12px rgba(214, 137, 16, 0.3);
        }

        .dark-theme .retry-preset-btn.active {
            background: #d68910;
            color: white;
            box-shadow: 0 4px 12px rgba(214, 137, 16, 0.4);
        }

        /* ÊªöÂä®Êù°Ê†∑Âºè */
        .dark-theme .model-list-container::-webkit-scrollbar,
        .dark-theme .results-tabs::-webkit-scrollbar,
        .dark-theme .key-list::-webkit-scrollbar {
            width: 8px;
        }

        .dark-theme .model-list-container::-webkit-scrollbar-track,
        .dark-theme .results-tabs::-webkit-scrollbar-track,
        .dark-theme .key-list::-webkit-scrollbar-track {
            background: #1e1e2e;
        }

        .dark-theme .model-list-container::-webkit-scrollbar-thumb,
        .dark-theme .results-tabs::-webkit-scrollbar-thumb,
        .dark-theme .key-list::-webkit-scrollbar-thumb {
            background: #4c63d2;
            border-radius: 4px;
        }

        .dark-theme .model-list-container::-webkit-scrollbar-thumb:hover,
        .dark-theme .results-tabs::-webkit-scrollbar-thumb:hover,
        .dark-theme .key-list::-webkit-scrollbar-thumb:hover {
            background: #5a73e0;
        }
    </style>
</head>
<body>
    <!-- ‰∏ªÈ¢òÂàáÊç¢ÊéßÂà∂ÊåâÈíÆ -->
    <div class="theme-controls">
        <button class="control-btn" id="langBtn" title="ÂàáÊç¢ËØ≠Ë®Ä">üåê</button>
        <button class="control-btn" id="themeBtn" title="ÂàáÊç¢‰∏ªÈ¢ò">üåô</button>
    </div>

    <div class="container">
        <div class="header">
            <h1 data-lang-key="title">üîë API Key ÊµãÊ¥ªÂ∑•ÂÖ∑</h1>
            <p data-lang-key="subtitle">ÊâπÈáèÊ£ÄÊµã Gemini„ÄÅClaude„ÄÅGPT API ÂØÜÈí•ÊúâÊïàÊÄß</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <div class="input-group">
                    <label for="apiType" data-lang-key="select-api">ÈÄâÊã© API Á±ªÂûã</label>
                    <select id="apiType" class="form-control">
                        <option value="openai">OpenAI GPT</option>
                        <option value="claude">Claude</option>
                        <option value="gemini">Google Gemini</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="modelInput" data-lang-key="select-model">ÊµãËØïÊ®°Âûã</label>
                    <div class="model-input-group">
                        <select id="modelSelect" class="form-control">
                            <!-- Ê®°ÂûãÈÄâÈ°π‰ºöÊ†πÊçÆAPIÁ±ªÂûãÂä®ÊÄÅÊõ¥Êñ∞ -->
                        </select>
                        <input type="text" id="modelInput" class="form-control hidden" data-lang-key="model-input-placeholder" placeholder="ËæìÂÖ•Ëá™ÂÆö‰πâÊ®°ÂûãÂêç">
                        <button type="button" class="model-toggle-btn" id="modelToggleBtn" data-lang-key="custom-model">Ëá™ÂÆö‰πâ</button>
                    </div>
                    <small class="form-help" data-lang-key="model-help">ÂèØ‰ª•ÈÄâÊã©È¢ÑËÆæÊ®°ÂûãÊàñËæìÂÖ•Ëá™ÂÆö‰πâÊ®°ÂûãÂêç</small>
                </div>

                <div class="detected-models" id="detectedModels">
                    <div class="detected-models-header" id="detectedModelsHeader">
                        <h4 data-lang-key="detected-models-title">Ê£ÄÊµãÂà∞ÁöÑÂèØÁî®Ê®°Âûã</h4>
                        <span class="collapse-icon collapsed" id="collapseIcon">‚ñº</span>
                    </div>
                    <div class="model-list-container" id="modelListContainer">
                        <div class="model-list" id="modelList"></div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="proxyUrl" data-lang-key="proxy-url">‰ª£ÁêÜÊúçÂä°Âô® URL (ÂèØÈÄâ)</label>
                    <input type="text" id="proxyUrl" class="form-control" placeholder="https://your-proxy.com">
                    <small class="form-help" data-lang-key="proxy-help">ÁïôÁ©∫‰ΩøÁî®ÈªòËÆ§‰ª£ÁêÜÔºåÂª∫ËÆÆ‰ΩøÁî®Ëá™Â∑±ÁöÑÂèçÂêë‰ª£ÁêÜ‰ª•ÊèêÈ´òÊàêÂäüÁéá</small>
                </div>

                <!-- Âπ∂ÂèëÊéßÂà∂ -->
                <div class="input-group">
                    <label data-lang-key="concurrency-control">Âπ∂ÂèëÊéßÂà∂</label>
                    <div class="concurrency-container">
                        <div class="concurrency-input-section">
                            <input type="number" id="concurrencyInput" class="form-control" value="5" min="1">
                        </div>
                        <div class="slider-section">
                            <div class="slider-container">
                                <input type="range" id="concurrencySlider" class="slider" min="1" max="50" value="5">
                                <span class="slider-value" id="sliderValue">5</span>
                            </div>
                            <div class="preset-buttons">
                                <button type="button" class="preset-btn" data-concurrency="1" data-lang-key="slow">ÊÖ¢ÈÄü</button>
                                <button type="button" class="preset-btn active" data-concurrency="5" data-lang-key="normal">Ê≠£Â∏∏</button>
                                <button type="button" class="preset-btn" data-concurrency="10" data-lang-key="fast">Âø´ÈÄü</button>
                                <button type="button" class="preset-btn" data-concurrency="20" data-lang-key="ultra">ÊûÅÈÄü</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÈáçËØïÊéßÂà∂ -->
                <div class="input-group">
                    <label data-lang-key="retry-control">ÈáçËØïÊéßÂà∂</label>
                    <div class="retry-container">
                        <div class="retry-input-section">
                            <input type="number" id="retryInput" class="form-control" value="3" min="0" max="10">
                        </div>
                        <div class="retry-slider-section">
                            <div class="retry-slider-container">
                                <input type="range" id="retrySlider" class="retry-slider" min="0" max="10" value="3">
                                <span class="retry-slider-value" id="retrySliderValue">3</span>
                            </div>
                            <div class="retry-preset-buttons">
                                <button type="button" class="retry-preset-btn" data-retry="0" data-lang-key="no-retry">‰∏çÈáçËØï</button>
                                <button type="button" class="retry-preset-btn" data-retry="2" data-lang-key="light-retry">ËΩªÂ∫¶</button>
                                <button type="button" class="retry-preset-btn active" data-retry="3" data-lang-key="normal-retry">Ê≠£Â∏∏</button>
                                <button type="button" class="retry-preset-btn" data-retry="5" data-lang-key="heavy-retry">ÈáçÂ∫¶</button>
                            </div>
                        </div>
                    </div>
                    <small class="form-help" data-lang-key="retry-help">ÈÅáÂà∞‰∏¥Êó∂ÈîôËØØ(Â¶Ç403)Êó∂ÈáçËØïÊ¨°Êï∞ÔºåÊúâÂä©‰∫éÊèêÈ´òÊ£ÄÊµãÂáÜÁ°ÆÊÄß</small>
                </div>
                
                <div class="input-group">
                    <label for="apiKeys" data-lang-key="api-keys">API ÂØÜÈí•ÂàóË°® (ÊØèË°å‰∏Ä‰∏™)</label>
                    <textarea id="apiKeys" class="form-control textarea" data-lang-key="api-keys-placeholder" placeholder="ËØ∑ËæìÂÖ•APIÂØÜÈí•ÔºåÊØèË°å‰∏Ä‰∏™Ôºö&#10;sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#10;sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#10;..."></textarea>
                </div>
                
                <div class="alert">
                    <strong data-lang-key="usage-title">üí° ‰ΩøÁî®ËØ¥ÊòéÔºö</strong> 
                    <br><span data-lang-key="usage-1">‚Ä¢ Âº∫ÁÉàÂª∫ËÆÆ‰ΩøÁî®Ëá™ÂÆö‰πâ‰ª£ÁêÜURLÔºåÂÖ¨ÂÖ±‰ª£ÁêÜÂèØËÉΩ‰∏çÁ®≥ÂÆö</span>
                    <br><span data-lang-key="usage-2">‚Ä¢ Gemini‰ª£ÁêÜÁ§∫‰æã: https://gemini.api.2s.lol/v1beta</span>
                    <br><span data-lang-key="usage-3">‚Ä¢ OpenAI‰ª£ÁêÜÁ§∫‰æã: https://api.openai-proxy.org/v1</span>
                    <br><span data-lang-key="usage-4">‚Ä¢ Claude‰ª£ÁêÜÁ§∫‰æã: https://claude-api-proxy.com/v1</span>
                    <br><span data-lang-key="usage-5">‚Ä¢ Áõ¥Êé•ËÆøÈóÆÂÆòÊñπAPI‰ºöÂõ†CORSÈôêÂà∂Â§±Ë¥•</span>
                    <br><span data-lang-key="usage-6">‚Ä¢ ÊµãËØïËøáÁ®ã‰∏≠ÂØÜÈí•‰ªÖÁî®‰∫éÈ™åËØÅÔºå‰∏ç‰ºöË¢´Â≠òÂÇ®</span>
                    <br><span data-lang-key="usage-7">‚Ä¢ Êô∫ËÉΩÈáçËØïÊú∫Âà∂ÂèØÊèêÈ´òÊ£ÄÊµãÂáÜÁ°ÆÊÄßÔºåÂáèÂ∞ëËØØÂà§</span>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-detect" id="detectBtn" data-lang-key="detect-models">Ê£ÄÊµãÊ®°Âûã</button>
                    <button class="btn btn-primary" id="startBtn" data-lang-key="start-test">ÂºÄÂßãÊµãËØï</button>
                    <button class="btn btn-secondary" id="dedupeBtn" data-lang-key="dedupe-keys">ÂéªÈáçÂØÜÈí•</button>
                    <button class="btn btn-secondary" id="clearBtn" data-lang-key="clear">Ê∏ÖÁ©∫</button>
                </div>
            </div>
            
            <div class="progress-bar hidden" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="loading hidden" id="loading">
                <div class="spinner"></div>
                <p data-lang-key="testing">Ê≠£Âú®ÊµãËØï API ÂØÜÈí•...</p>
            </div>
            
            <div class="results-section hidden" id="resultsSection">
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number total" id="totalCount">0</div>
                        <div class="stat-label" data-lang-key="total">ÊÄªËÆ°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number valid" id="validCount">0</div>
                        <div class="stat-label" data-lang-key="valid">ÊúâÊïà</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number invalid" id="invalidCount">0</div>
                        <div class="stat-label" data-lang-key="invalid">Êó†Êïà</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number rate-limited" id="rateLimitedCount">0</div>
                        <div class="stat-label" data-lang-key="rate-limited">ÈÄüÁéáÈôêÂà∂</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number testing" id="testingCount">0</div>
                        <div class="stat-label" data-lang-key="testing-label">ÊµãËØï‰∏≠</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number retrying" id="retryingCount">0</div>
                        <div class="stat-label" data-lang-key="retrying">ÈáçËØï‰∏≠</div>
                    </div>
                </div>
                
                <div class="results-tabs">
                    <button class="tab active" data-tab="all" data-lang-key="all">ÂÖ®ÈÉ®</button>
                    <button class="tab" data-tab="valid" data-lang-key="valid-keys">ÊúâÊïàÂØÜÈí•</button>
                    <button class="tab" data-tab="invalid" data-lang-key="invalid-keys">Êó†ÊïàÂØÜÈí•</button>
                    <button class="tab" data-tab="rate-limited" data-lang-key="rate-limited-keys">ÈÄüÁéáÈôêÂà∂</button>
                </div>
                
                <div class="tab-content active" id="allTab">
                    <div class="key-list" id="allKeys"></div>
                    <button class="copy-btn" data-copy="all" data-lang-key="copy-all">Â§çÂà∂ÂÖ®ÈÉ®</button>
                </div>
                
                <div class="tab-content" id="validTab">
                    <div class="key-list" id="validKeys"></div>
                    <button class="copy-btn" data-copy="valid" data-lang-key="copy-valid">Â§çÂà∂ÊúâÊïàÂØÜÈí•</button>
                </div>
                
                <div class="tab-content" id="invalidTab">
                    <div class="key-list" id="invalidKeys"></div>
                    <button class="copy-btn" data-copy="invalid" data-lang-key="copy-invalid">Â§çÂà∂Êó†ÊïàÂØÜÈí•</button>
                </div>
                
                <div class="tab-content" id="rateLimitedTab">
                    <div class="key-list" id="rateLimitedKeys"></div>
                    <button class="copy-btn" data-copy="rate-limited" data-lang-key="copy-rate-limited">Â§çÂà∂ÈÄüÁéáÈôêÂà∂ÂØÜÈí•</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let allKeysData = [];
        let currentLang = 'zh';
        let isDarkTheme = false;
        let isCustomModel = false;
        let detectedModels = new Set();
        let currentConcurrency = 5;
        let currentRetryCount = 3;
        let isTestingInProgress = false;
        let completedCount = 0;
        let totalCount = 0;
        let updateTimer = null;

        // Ê®°ÂûãÈÖçÁΩÆ - ‰ΩøÁî®ÂÆòÊñπÂêçÁß∞
        const modelOptions = {
            openai: [
                'gpt-4o',
                'gpt-4o-mini', 
                'gpt-4-turbo',
                'gpt-4',
                'gpt-3.5-turbo'
            ],
            claude: [
                'claude-3-5-sonnet-20241022',
                'claude-3-5-haiku-20241022',
                'claude-3-opus-20240229',
                'claude-3-sonnet-20240229',
                'claude-3-haiku-20240307'
            ],
            gemini: [
                'gemini-2.0-flash',
                'gemini-2.5-flash',
                'gemini-2.5-pro'
            ]
        };
        
        const translations = {
            zh: {
                'title': 'üîë API Key ÊµãÊ¥ªÂ∑•ÂÖ∑',
                'subtitle': 'ÊâπÈáèÊ£ÄÊµã Gemini„ÄÅClaude„ÄÅGPT API ÂØÜÈí•ÊúâÊïàÊÄß',
                'select-api': 'ÈÄâÊã© API Á±ªÂûã',
                'select-model': 'ÊµãËØïÊ®°Âûã',
                'custom-model': 'Ëá™ÂÆö‰πâ',
                'preset-model': 'È¢ÑËÆæ',
                'model-help': 'ÂèØ‰ª•ÈÄâÊã©È¢ÑËÆæÊ®°ÂûãÊàñËæìÂÖ•Ëá™ÂÆö‰πâÊ®°ÂûãÂêç',
                'model-input-placeholder': 'ËæìÂÖ•Ëá™ÂÆö‰πâÊ®°ÂûãÂêç',
                'detected-models-title': 'Ê£ÄÊµãÂà∞ÁöÑÂèØÁî®Ê®°Âûã',
                'proxy-url': '‰ª£ÁêÜÊúçÂä°Âô® URL (ÂèØÈÄâ)',
                'proxy-help': 'ÁïôÁ©∫‰ΩøÁî®ÈªòËÆ§‰ª£ÁêÜÔºåÂª∫ËÆÆ‰ΩøÁî®Ëá™Â∑±ÁöÑÂèçÂêë‰ª£ÁêÜ‰ª•ÊèêÈ´òÊàêÂäüÁéá',
                'concurrency-control': 'Âπ∂ÂèëÊéßÂà∂',
                'retry-control': 'ÈáçËØïÊéßÂà∂',
                'retry-help': 'ÈÅáÂà∞‰∏¥Êó∂ÈîôËØØ(Â¶Ç403)Êó∂ÈáçËØïÊ¨°Êï∞ÔºåÊúâÂä©‰∫éÊèêÈ´òÊ£ÄÊµãÂáÜÁ°ÆÊÄß',
                'slow': 'ÊÖ¢ÈÄü',
                'normal': 'Ê≠£Â∏∏',
                'fast': 'Âø´ÈÄü',
                'ultra': 'ÊûÅÈÄü',
                'no-retry': '‰∏çÈáçËØï',
                'light-retry': 'ËΩªÂ∫¶',
                'normal-retry': 'Ê≠£Â∏∏',
                'heavy-retry': 'ÈáçÂ∫¶',
                'api-keys': 'API ÂØÜÈí•ÂàóË°® (ÊØèË°å‰∏Ä‰∏™)',
                'api-keys-placeholder': 'ËØ∑ËæìÂÖ•APIÂØÜÈí•ÔºåÊØèË°å‰∏Ä‰∏™Ôºö\nsk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nsk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n...',
                'usage-title': 'üí° ‰ΩøÁî®ËØ¥ÊòéÔºö',
                'usage-1': '‚Ä¢ Âº∫ÁÉàÂª∫ËÆÆ‰ΩøÁî®Ëá™ÂÆö‰πâ‰ª£ÁêÜURLÔºåÂÖ¨ÂÖ±‰ª£ÁêÜÂèØËÉΩ‰∏çÁ®≥ÂÆö',
                'usage-2': '‚Ä¢ Gemini‰ª£ÁêÜÁ§∫‰æã: https://gemini.api.2s.lol/v1beta',
                'usage-3': '‚Ä¢ OpenAI‰ª£ÁêÜÁ§∫‰æã: https://api.openai-proxy.org/v1',
                'usage-4': '‚Ä¢ Claude‰ª£ÁêÜÁ§∫‰æã: https://claude-api-proxy.com/v1',
                'usage-5': '‚Ä¢ Áõ¥Êé•ËÆøÈóÆÂÆòÊñπAPI‰ºöÂõ†CORSÈôêÂà∂Â§±Ë¥•',
                'usage-6': '‚Ä¢ ÊµãËØïËøáÁ®ã‰∏≠ÂØÜÈí•‰ªÖÁî®‰∫éÈ™åËØÅÔºå‰∏ç‰ºöË¢´Â≠òÂÇ®',
                'usage-7': '‚Ä¢ Êô∫ËÉΩÈáçËØïÊú∫Âà∂ÂèØÊèêÈ´òÊ£ÄÊµãÂáÜÁ°ÆÊÄßÔºåÂáèÂ∞ëËØØÂà§',
                'detect-models': 'Ê£ÄÊµãÊ®°Âûã',
                'start-test': 'ÂºÄÂßãÊµãËØï',
                'dedupe-keys': 'ÂéªÈáçÂØÜÈí•',
                'clear': 'Ê∏ÖÁ©∫',
                'testing': 'Ê≠£Âú®ÊµãËØï API ÂØÜÈí•...',
                'detecting': 'Ê≠£Âú®Ê£ÄÊµãÂèØÁî®Ê®°Âûã...',
                'no-models-detected': 'Êó†ÂèØÁî®Ê®°Âûã',
                'total': 'ÊÄªËÆ°',
                'valid': 'ÊúâÊïà',
                'invalid': 'Êó†Êïà',
                'rate-limited': 'ÈÄüÁéáÈôêÂà∂',
                'testing-label': 'ÊµãËØï‰∏≠',
                'retrying': 'ÈáçËØï‰∏≠',
                'all': 'ÂÖ®ÈÉ®',
                'valid-keys': 'ÊúâÊïàÂØÜÈí•',
                'invalid-keys': 'Êó†ÊïàÂØÜÈí•',
                'rate-limited-keys': 'ÈÄüÁéáÈôêÂà∂',
                'copy-all': 'Â§çÂà∂ÂÖ®ÈÉ®',
                'copy-valid': 'Â§çÂà∂ÊúâÊïàÂØÜÈí•',
                'copy-invalid': 'Â§çÂà∂Êó†ÊïàÂØÜÈí•',
                'copy-rate-limited': 'Â§çÂà∂ÈÄüÁéáÈôêÂà∂ÂØÜÈí•',
                'status-valid': 'ÊúâÊïà',
                'status-invalid': 'Êó†Êïà',
                'status-rate-limited': 'ÈÄüÁéáÈôêÂà∂',
                'status-testing': 'ÊµãËØï‰∏≠',
                'status-retrying': 'ÈáçËØï‰∏≠'
            },
            en: {
                'title': 'üîë API Key Tester',
                'subtitle': 'Batch test Gemini, Claude, GPT API key validity',
                'select-api': 'Select API Type',
                'select-model': 'Test Model',
                'custom-model': 'Custom',
                'preset-model': 'Preset',
                'model-help': 'Choose preset model or enter custom model name',
                'model-input-placeholder': 'Enter custom model name',
                'detected-models-title': 'Detected Available Models',
                'proxy-url': 'Proxy Server URL (Optional)',
                'proxy-help': 'Leave empty to use default proxy, recommend using your own reverse proxy for better success rate',
                'concurrency-control': 'Concurrency Control',
                'retry-control': 'Retry Control',
                'retry-help': 'Number of retries when encountering temporary errors (like 403), helps improve detection accuracy',
                'slow': 'Slow',
                'normal': 'Normal',
                'fast': 'Fast',
                'ultra': 'Ultra',
                'no-retry': 'No Retry',
                'light-retry': 'Light',
                'normal-retry': 'Normal',
                'heavy-retry': 'Heavy',
                'api-keys': 'API Key List (one per line)',
                'api-keys-placeholder': 'Enter API keys, one per line:\nsk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nsk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n...',
                'usage-title': 'üí° Usage Instructions:',
                'usage-1': '‚Ä¢ Strongly recommend using custom proxy URL, public proxies may be unstable',
                'usage-2': '‚Ä¢ Gemini proxy example: https://gemini.api.2s.lol/v1beta',
                'usage-3': '‚Ä¢ OpenAI proxy example: https://api.openai-proxy.org/v1',
                'usage-4': '‚Ä¢ Claude proxy example: https://claude-api-proxy.com/v1',
                'usage-5': '‚Ä¢ Direct access to official APIs will fail due to CORS restrictions',
                'usage-6': '‚Ä¢ Keys are only used for validation during testing, not stored',
                'usage-7': '‚Ä¢ Smart retry mechanism improves detection accuracy and reduces false negatives',
                'detect-models': 'Detect Models',
                'start-test': 'Start Test',
                'dedupe-keys': 'Dedupe Keys',
                'clear': 'Clear',
                'testing': 'Testing API keys...',
                'detecting': 'Detecting available models...',
                'no-models-detected': 'No Available Models',
                'total': 'Total',
                'valid': 'Valid',
                'invalid': 'Invalid',
                'rate-limited': 'Rate Limited',
                'testing-label': 'Testing',
                'retrying': 'Retrying',
                'all': 'All',
                'valid-keys': 'Valid Keys',
                'invalid-keys': 'Invalid Keys',
                'rate-limited-keys': 'Rate Limited',
                'copy-all': 'Copy All',
                'copy-valid': 'Copy Valid Keys',
                'copy-invalid': 'Copy Invalid Keys',
                'copy-rate-limited': 'Copy Rate Limited Keys',
                'status-valid': 'Valid',
                'status-invalid': 'Invalid',
                'status-rate-limited': 'Rate Limited',
                'status-testing': 'Testing',
                'status-retrying': 'Retrying'
            }
        };

        async function testApiKeyWithRetry(apiKey, apiType, maxRetries = 0) {
            const keyData = allKeysData.find(k => k.key === apiKey);
            
            for (let attempt = 0; attempt <= maxRetries; attempt++) {
                try {
                    // Êõ¥Êñ∞Áä∂ÊÄÅÂíåUI
                    if (keyData) {
                        if (attempt === 0) {
                            keyData.status = 'testing';
                            keyData.retryCount = 0;
                        } else {
                            keyData.status = 'retrying';
                            keyData.retryCount = attempt;
                            // ‰ºòÂåñÈáçËØïÂª∂Ëøü
                            await new Promise(resolve => setTimeout(resolve, 300 + Math.random() * 500));
                        }
                        updateUIAsync();
                    }
                    
                    // ÊâßË°åÂÆûÈôÖÊµãËØï
                    const result = await testApiKey(apiKey, apiType);
                    
                    // ÊàêÂäüÊàñÈÄüÁéáÈôêÂà∂ÔºöÁõ¥Êé•ËøîÂõûÔºå‰∏çÈáçËØï
                    if (result.valid || result.isRateLimit) {
                        return finalizeResult(keyData, result, attempt);
                    }
                    
                    // ÊúÄÂêé‰∏ÄÊ¨°Â∞ùËØïÔºöÊó†ËÆ∫ÁªìÊûúÂ¶Ç‰ΩïÈÉΩËøîÂõû
                    if (attempt === maxRetries) {
                        return finalizeResult(keyData, result, attempt);
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÈáçËØï
                    const statusCode = extractStatusCode(result.error);
                    if (!shouldRetry(result.error, statusCode)) {
                        // ‰∏çÈúÄË¶ÅÈáçËØïÁöÑÈîôËØØÁõ¥Êé•ËøîÂõû
                        return finalizeResult(keyData, result, attempt);
                    }
                    
                    // ÁªßÁª≠‰∏ã‰∏ÄÊ¨°ÈáçËØï...
                    // ÈáçËØïÈÄªËæë
                    
                } catch (error) {
                    console.error(`ÊµãËØïÂØÜÈí• ${apiKey.substring(0, 10)}... Á¨¨ ${attempt + 1} Ê¨°Â∞ùËØïÂºÇÂ∏∏:`, error);
                    
                    if (attempt === maxRetries) {
                        const errorResult = { 
                            valid: false, 
                            error: 'ÊµãËØïÂºÇÂ∏∏: ' + error.message, 
                            isRateLimit: false 
                        };
                        return finalizeResult(keyData, errorResult, attempt);
                    }
                    
                    // ÂºÇÂ∏∏‰πüÂèØ‰ª•ÈáçËØï
                    if (keyData) {
                        keyData.status = 'retrying';
                        keyData.retryCount = attempt + 1;
                        updateUIAsync();
                    }
                }
            }
        }

        // ÂÆåÊàêÊµãËØïÁªìÊûúÂ§ÑÁêÜ
        function finalizeResult(keyData, result, retryCount) {
            if (keyData) {
                keyData.retryCount = retryCount;
                keyData.error = result.error;
                
                if (result.valid) {
                    keyData.status = 'valid';
                } else if (result.isRateLimit) {
                    keyData.status = 'rate-limited';
                } else {
                    keyData.status = 'invalid';
                }
            }
            return result;
        }

        // ‰øÆÂ§çÂêéÁöÑ‰∏ªÊµãËØïÂáΩÊï∞
        async function startTesting() {
            const apiType = document.getElementById('apiType').value;
            const apiKeysText = document.getElementById('apiKeys').value.trim();
            const selectedModel = getSelectedModel();
            
            if (!apiKeysText) {
                alert(currentLang === 'zh' ? 'ËØ∑ËæìÂÖ•APIÂØÜÈí•ÔºÅ' : 'Please enter API keys!');
                return;
            }

            if (!selectedModel) {
                alert(currentLang === 'zh' ? 'ËØ∑ÈÄâÊã©ÊàñËæìÂÖ•Ê®°ÂûãÂêçÔºÅ' : 'Please select or enter model name!');
                return;
            }

            if (isTestingInProgress) {
                alert(currentLang === 'zh' ? 'ÊµãËØïÊ≠£Âú®ËøõË°å‰∏≠ÔºåËØ∑Á≠âÂæÖÂÆåÊàêÔºÅ' : 'Testing in progress, please wait for completion!');
                return;
            }
            
            const rawKeys = apiKeysText.split('\n').filter(key => key.trim());
            
            if (rawKeys.length === 0) {
                alert(currentLang === 'zh' ? 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑAPIÂØÜÈí•ÔºÅ' : 'Please enter valid API keys!');
                return;
            }
            
            // ÂéªÈáçÂ§ÑÁêÜ
            const { uniqueKeys, duplicates } = deduplicateAndCleanKeys(rawKeys);
            
            // Â¶ÇÊûúÂèëÁé∞ÈáçÂ§çÂØÜÈí•ÔºåÊèêÁ§∫Áî®Êà∑
            if (duplicates.length > 0) {
                const message = currentLang === 'zh' ? 
                    `ÂèëÁé∞ ${duplicates.length} ‰∏™ÈáçÂ§çÂØÜÈí•ÔºåÂ∑≤Ëá™Âä®ÂéªÈô§„ÄÇÂ∞ÜÊµãËØï ${uniqueKeys.length} ‰∏™ÂîØ‰∏ÄÂØÜÈí•„ÄÇ` :
                    `Found ${duplicates.length} duplicate keys, automatically removed. Will test ${uniqueKeys.length} unique keys.`;
                alert(message);
            }
            
            // ËÆæÁΩÆÊµãËØïÁä∂ÊÄÅ
            isTestingInProgress = true;
            completedCount = 0;
            totalCount = uniqueKeys.length;
            
            // ÈáçÁΩÆÊï∞ÊçÆ
            allKeysData = [];
            
            // ÂàùÂßãÂåñÊâÄÊúâÂØÜÈí•‰∏∫pendingÁä∂ÊÄÅ
            uniqueKeys.forEach(apiKey => {
                const keyData = {
                    key: apiKey,
                    status: 'pending',
                    error: null,
                    type: apiType,
                    model: selectedModel,
                    retryCount: 0
                };
                allKeysData.push(keyData);
            });
            
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('progressBar').classList.remove('hidden');
            document.getElementById('resultsSection').classList.remove('hidden');
            
            updateStats();
            updateKeyLists();
            
            try {
                // ‰ΩøÁî®Ê≠£Á°ÆÁöÑÂõ∫ÂÆöÂπ∂ÂèëÂ§ÑÁêÜ
                await processWithFixedConcurrency(uniqueKeys, apiType);
            } catch (error) {
                // ÊµãËØïËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØÔºåÁªßÁª≠ÊâßË°åÊ∏ÖÁêÜÊìç‰Ωú
            } finally {
                // Á°Æ‰øùÊµãËØïÂÆåÊàêÂêéÊ∏ÖÁêÜÁä∂ÊÄÅ
                isTestingInProgress = false;
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('progressBar').classList.add('hidden');
                
                // ÊúÄÁªàÊõ¥Êñ∞ÁªüËÆ°ÂíåÂàóË°®
                updateStats();
                updateKeyLists();
                
                // ÊòæÁ§∫ÊµãËØïÂÆåÊàêÊèêÁ§∫
                showCompletionMessage();
            }
        }

        // Ê≠£Á°ÆÁöÑÂõ∫ÂÆöÂπ∂ÂèëÂ§ÑÁêÜÈÄªËæë
        async function processWithFixedConcurrency(apiKeys, apiType) {
            const keyQueue = [...apiKeys];
            const activeSlots = new Array(currentConcurrency).fill(null);
            let nextKeyIndex = 0;
            
            // ÂºÄÂßãÊµãËØïÂ§ÑÁêÜ
            
            // ÂàùÂßãÂ°´Êª°ÊâÄÊúâÂπ∂ÂèëÊßΩ‰Ωç
            for (let i = 0; i < currentConcurrency && i < keyQueue.length; i++) {
                activeSlots[i] = startKeyTest(keyQueue[nextKeyIndex], apiType, i);
                nextKeyIndex++;
            }
            
            // ÊåÅÁª≠Â§ÑÁêÜÁõ¥Âà∞ÊâÄÊúâÂØÜÈí•ÂÆåÊàê
            while (activeSlots.some(slot => slot !== null)) {
                // Á≠âÂæÖ‰ªªÊÑè‰∏Ä‰∏™ÊßΩ‰ΩçÂÆåÊàê
                const completedIndex = await waitForAnySlotCompletion(activeSlots);
                
                // Êõ¥Êñ∞ËøõÂ∫¶
                completedCount++;
                updateProgress();
                
                // Êõ¥Êñ∞ËøõÂ∫¶
                
                // Â¶ÇÊûúËøòÊúâÂæÖÊµãËØïÁöÑÂØÜÈí•ÔºåÂêØÂä®Êñ∞ÁöÑÊµãËØïÂç†Áî®Ëøô‰∏™ÊßΩ‰Ωç
                if (nextKeyIndex < keyQueue.length) {
                    activeSlots[completedIndex] = startKeyTest(keyQueue[nextKeyIndex], apiType, completedIndex);
                    nextKeyIndex++;
                } else {
                    // Ê≤°ÊúâÊñ∞ÂØÜÈí•‰∫ÜÔºåÈáäÊîæÊßΩ‰Ωç
                    activeSlots[completedIndex] = null;
                }
            }
            
            // ÊµãËØïÂÆåÊàê
        }

        // ÂêØÂä®Âçï‰∏™ÂØÜÈí•ÊµãËØï
        async function startKeyTest(apiKey, apiType, slotIndex) {
            // ÂºÄÂßãÊµãËØïÂØÜÈí•
            
            try {
                const result = await testApiKeyWithRetry(apiKey, apiType, currentRetryCount);
                // ÊµãËØïÂÆåÊàê
                return result;
            } catch (error) {
                // Â§ÑÁêÜÊµãËØïÂºÇÂ∏∏
                
                // Â§ÑÁêÜÊµãËØïÂºÇÂ∏∏
                const keyData = allKeysData.find(k => k.key === apiKey);
                if (keyData) {
                    keyData.status = 'invalid';
                    keyData.error = 'ÊµãËØïÂºÇÂ∏∏: ' + error.message;
                }
                return { valid: false, error: error.message, isRateLimit: false };
            } finally {
                updateUIAsync();
            }
        }

        // Á≠âÂæÖ‰ªªÊÑèÊßΩ‰ΩçÂÆåÊàê
        async function waitForAnySlotCompletion(activeSlots) {
            const activePromises = activeSlots
                .map((promise, index) => promise ? promise.then(() => index) : null)
                .filter(p => p !== null);
            
            if (activePromises.length === 0) {
                throw new Error('Ê≤°ÊúâÊ¥ªË∑ÉÁöÑÊµãËØï‰ªªÂä°');
            }
            
            return await Promise.race(activePromises);
        }

        // ÂºÇÊ≠•Êõ¥Êñ∞UI
        function updateUIAsync() {
            if (updateTimer) return;
            
            updateTimer = setTimeout(() => {
                updateStats();
                updateKeyLists();
                updateTimer = null;
            }, 50);
        }

        // Êõ¥Êñ∞ËøõÂ∫¶Êù°
        function updateProgress() {
            const progress = (completedCount / totalCount) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÈáçËØï
        function shouldRetry(error, statusCode) {
            // 403„ÄÅ502„ÄÅ503„ÄÅ504 Á≠â‰∏¥Êó∂ÈîôËØØÈúÄË¶ÅÈáçËØï
            if ([403, 502, 503, 504].includes(statusCode)) {
                return true;
            }
            
            if (error && typeof error === 'string') {
                const errorLower = error.toLowerCase();
                if (errorLower.includes('timeout') || 
                    errorLower.includes('network') || 
                    errorLower.includes('ËøûÊé•') ||
                    errorLower.includes('fetch')) {
                    return true;
                }
            }
            
            return false;
        }

        // ÊèêÂèñHTTPÁä∂ÊÄÅÁ†Å
        function extractStatusCode(error) {
            if (!error || typeof error !== 'string') return null;
            
            const match = error.match(/\((\d{3})\)/);
            if (match) {
                return parseInt(match[1]);
            }
            
            if (error.includes('HTTP ')) {
                const httpMatch = error.match(/HTTP (\d{3})/);
                if (httpMatch) {
                    return parseInt(httpMatch[1]);
                }
            }
            
            return null;
        }

        // ÊòæÁ§∫ÂÆåÊàêÊ∂àÊÅØ
        function showCompletionMessage() {
            const validCount = allKeysData.filter(k => k.status === 'valid').length;
            const invalidCount = allKeysData.filter(k => k.status === 'invalid').length;
            const rateLimitedCount = allKeysData.filter(k => k.status === 'rate-limited').length;
            
            const message = currentLang === 'zh' ? 
                `ÊµãËØïÂÆåÊàêÔºÅÊúâÊïàÂØÜÈí•: ${validCount}ÔºåÊó†ÊïàÂØÜÈí•: ${invalidCount}ÔºåÈÄüÁéáÈôêÂà∂: ${rateLimitedCount}` :
                `Test completed! Valid keys: ${validCount}, Invalid keys: ${invalidCount}, Rate limited: ${rateLimitedCount}`;
            alert(message);
        }

        // ÈáçËØïÊéßÂà∂Áõ∏ÂÖ≥ÂáΩÊï∞
        function updateRetryCount(value) {
            currentRetryCount = parseInt(value);
            document.getElementById('retryInput').value = currentRetryCount;
            document.getElementById('retrySlider').value = currentRetryCount;
            document.getElementById('retrySliderValue').textContent = currentRetryCount;
            
            // Êõ¥Êñ∞È¢ÑËÆæÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.retry-preset-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.getAttribute('data-retry')) === currentRetryCount) {
                    btn.classList.add('active');
                }
            });
        }

        function initRetryControls() {
            const input = document.getElementById('retryInput');
            const slider = document.getElementById('retrySlider');
            const presetButtons = document.querySelectorAll('.retry-preset-btn');

            // ËæìÂÖ•Ê°ÜÂèòÂåñ
            input.addEventListener('input', (e) => {
                let value = parseInt(e.target.value);
                if (isNaN(value) || value < 0) value = 0;
                if (value > 10) value = 10;
                e.target.value = value;
                updateRetryCount(value);
            });

            // ÊªëÂùóÂèòÂåñ
            slider.addEventListener('input', (e) => {
                updateRetryCount(e.target.value);
            });

            // È¢ÑËÆæÊåâÈíÆ
            presetButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const value = parseInt(btn.getAttribute('data-retry'));
                    updateRetryCount(value);
                });
            });

            // ÂàùÂßãÂåñ
            updateRetryCount(3);
        }

        // Âπ∂ÂèëÊéßÂà∂Áõ∏ÂÖ≥ÂáΩÊï∞
        function updateConcurrency(value) {
            currentConcurrency = parseInt(value);
            document.getElementById('concurrencyInput').value = currentConcurrency;
            document.getElementById('concurrencySlider').value = Math.min(currentConcurrency, 50);
            document.getElementById('sliderValue').textContent = currentConcurrency;
            
            // Êõ¥Êñ∞È¢ÑËÆæÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.getAttribute('data-concurrency')) === currentConcurrency) {
                    btn.classList.add('active');
                }
            });
        }

        function initConcurrencyControls() {
            const input = document.getElementById('concurrencyInput');
            const slider = document.getElementById('concurrencySlider');
            const presetButtons = document.querySelectorAll('.preset-btn');

            // ËæìÂÖ•Ê°ÜÂèòÂåñ
            input.addEventListener('input', (e) => {
                let value = parseInt(e.target.value);
                if (isNaN(value) || value < 1) value = 1;
                e.target.value = value;
                updateConcurrency(value);
            });

            // ÊªëÂùóÂèòÂåñ
            slider.addEventListener('input', (e) => {
                updateConcurrency(e.target.value);
            });

            // È¢ÑËÆæÊåâÈíÆ
            presetButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const value = parseInt(btn.getAttribute('data-concurrency'));
                    updateConcurrency(value);
                });
            });

            // ÂàùÂßãÂåñ
            updateConcurrency(5);
        }

        function updateModelOptions() {
            const apiType = document.getElementById('apiType').value;
            const modelSelect = document.getElementById('modelSelect');
            const options = modelOptions[apiType];
            
            modelSelect.innerHTML = '';
            options.forEach(model => {
                const optionElement = document.createElement('option');
                optionElement.value = model;
                optionElement.textContent = model;
                modelSelect.appendChild(optionElement);
            });
        }
        
        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateLanguage();
        }
        
        function updateLanguage() {
            const elements = document.querySelectorAll('[data-lang-key]');
            elements.forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[currentLang][key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = translations[currentLang][key];
                    } else {
                        element.textContent = translations[currentLang][key];
                    }
                }
            });
            updateModelOptions();
            updateKeyLists();
        }
        
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            const themeBtn = document.getElementById('themeBtn');
            
            if (isDarkTheme) {
                document.body.classList.add('dark-theme');
                themeBtn.textContent = '‚òÄÔ∏è';
                themeBtn.title = currentLang === 'zh' ? 'ÂàáÊç¢Âà∞ÊµÖËâ≤Ê®°Âºè' : 'Switch to Light Mode';
            } else {
                document.body.classList.remove('dark-theme');
                themeBtn.textContent = 'üåô';
                themeBtn.title = currentLang === 'zh' ? 'ÂàáÊç¢Âà∞Ê∑±Ëâ≤Ê®°Âºè' : 'Switch to Dark Mode';
            }
        }

        function toggleModelInput() {
            isCustomModel = !isCustomModel;
            const modelSelect = document.getElementById('modelSelect');
            const modelInput = document.getElementById('modelInput');
            const toggleBtn = document.getElementById('modelToggleBtn');
            
            if (isCustomModel) {
                modelSelect.classList.add('hidden');
                modelInput.classList.remove('hidden');
                toggleBtn.textContent = translations[currentLang]['preset-model'];
                toggleBtn.classList.add('active');
            } else {
                modelSelect.classList.remove('hidden');
                modelInput.classList.add('hidden');
                toggleBtn.textContent = translations[currentLang]['custom-model'];
                toggleBtn.classList.remove('active');
            }
        }

        function getSelectedModel() {
            if (isCustomModel) {
                return document.getElementById('modelInput').value.trim();
            } else {
                return document.getElementById('modelSelect').value;
            }
        }

        function addDetectedModel(model) {
            if (!detectedModels.has(model)) {
                detectedModels.add(model);
                updateDetectedModelsList();
            }
        }

        function updateDetectedModelsList() {
            const modelList = document.getElementById('modelList');
            const detectedModelsDiv = document.getElementById('detectedModels');
            const modelCountSpan = document.querySelector('#detectedModelsHeader h4');
            
            if (detectedModels.size > 0) {
                detectedModelsDiv.style.display = 'block';
                
                // Êõ¥Êñ∞Ê†áÈ¢òÊòæÁ§∫Ê®°ÂûãÊï∞Èáè
                const titleKey = 'detected-models-title';
                const baseTitle = translations[currentLang][titleKey];
                modelCountSpan.textContent = `${baseTitle} (${detectedModels.size})`;
                
                modelList.innerHTML = '';
                
                detectedModels.forEach(model => {
                    const modelTag = document.createElement('div');
                    modelTag.className = 'model-tag';
                    modelTag.textContent = model;
                    modelTag.onclick = () => selectDetectedModel(model);
                    modelList.appendChild(modelTag);
                });
            } else {
                detectedModelsDiv.style.display = 'none';
            }
        }

        function toggleModelList() {
            const container = document.getElementById('modelListContainer');
            const icon = document.getElementById('collapseIcon');
            
            if (container.classList.contains('expanded')) {
                container.classList.remove('expanded');
                icon.classList.add('collapsed');
            } else {
                container.classList.add('expanded');
                icon.classList.remove('collapsed');
            }
        }

        function selectDetectedModel(model) {
            if (isCustomModel) {
                document.getElementById('modelInput').value = model;
            } else {
                const modelSelect = document.getElementById('modelSelect');
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ËØ•ÈÄâÈ°π
                let optionExists = false;
                for (let option of modelSelect.options) {
                    if (option.value === model) {
                        modelSelect.value = model;
                        optionExists = true;
                        break;
                    }
                }
                // Â¶ÇÊûú‰∏çÂ≠òÂú®ÔºåÊ∑ªÂä†Êñ∞ÈÄâÈ°π
                if (!optionExists) {
                    const newOption = document.createElement('option');
                    newOption.value = model;
                    newOption.textContent = model;
                    modelSelect.appendChild(newOption);
                    modelSelect.value = model;
                }
            }
        }

        function getApiUrl(apiType, endpoint) {
            const proxyUrl = document.getElementById('proxyUrl').value.trim();
            
            if (proxyUrl) {
                const baseUrl = proxyUrl.endsWith('/') ? proxyUrl.slice(0, -1) : proxyUrl;
                return baseUrl + endpoint;
            } else {
                switch (apiType) {
                    case 'openai':
                        return 'https://corsproxy.io/?' + encodeURIComponent('https://api.openai.com' + endpoint);
                    case 'claude':
                        return 'https://corsproxy.io/?' + encodeURIComponent('https://api.anthropic.com' + endpoint);
                    case 'gemini':
                        return 'https://gemini.api.2s.lol/v1beta' + endpoint;
                }
            }
        }
        
        function updateProxyPlaceholder() {
            const apiType = document.getElementById('apiType').value;
            const proxyInput = document.getElementById('proxyUrl');
            
            switch (apiType) {
                case 'openai':
                    proxyInput.placeholder = 'https://api.openai-proxy.org/v1';
                    break;
                case 'claude':
                    proxyInput.placeholder = 'https://claude-api-proxy.com/v1';
                    break;
                case 'gemini':
                    proxyInput.placeholder = 'https://gemini.api.2s.lol/v1beta';
                    break;
            }
            
            updateModelOptions();
        }

        async function detectModels() {
            const apiType = document.getElementById('apiType').value;
            const apiKeysText = document.getElementById('apiKeys').value.trim();
            
            if (!apiKeysText) {
                alert(currentLang === 'zh' ? 'ËØ∑ÂÖàËæìÂÖ•APIÂØÜÈí•ÔºÅ' : 'Please enter API keys first!');
                return;
            }
            
            const apiKeys = apiKeysText.split('\n').filter(key => key.trim());
            
            if (apiKeys.length === 0) {
                alert(currentLang === 'zh' ? 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑAPIÂØÜÈí•ÔºÅ' : 'Please enter valid API keys!');
                return;
            }

            // Âè™ÂèñÁ¨¨‰∏Ä‰∏™keyËøõË°åÊ£ÄÊµã
            const testKey = apiKeys[0].trim();
            
            document.getElementById('loading').classList.remove('hidden');
            const loadingText = document.querySelector('#loading p');
            loadingText.textContent = translations[currentLang]['detecting'];
            
            detectedModels.clear();
            
            try {
                const models = await getAvailableModels(testKey, apiType);
                
                if (models && models.length > 0) {
                    models.forEach(model => addDetectedModel(model));
                    alert(currentLang === 'zh' ? 
                        `Ê£ÄÊµãÂà∞ ${models.length} ‰∏™ÂèØÁî®Ê®°Âûã` : 
                        `Detected ${models.length} available models`);
                } else {
                    alert(currentLang === 'zh' ? 
                        'Êú™Ê£ÄÊµãÂà∞ÂèØÁî®Ê®°Âûã„ÄÇËØ∑Ê£ÄÊü•Ôºö\n‚Ä¢ APIÂØÜÈí•ÊòØÂê¶ÊúâÊïà\n‚Ä¢ ‰ª£ÁêÜËÆæÁΩÆÊòØÂê¶Ê≠£Á°Æ\n‚Ä¢ ÁΩëÁªúËøûÊé•ÊòØÂê¶Ê≠£Â∏∏' : 
                        'No available models detected. Please check:\n‚Ä¢ API key validity\n‚Ä¢ Proxy settings\n‚Ä¢ Network connection');
                }
            } catch (error) {
                alert(currentLang === 'zh' ? 
                    'Êú™Ê£ÄÊµãÂà∞ÂèØÁî®Ê®°Âûã„ÄÇËØ∑Ê£ÄÊü•Ôºö\n‚Ä¢ APIÂØÜÈí•ÊòØÂê¶ÊúâÊïà\n‚Ä¢ ‰ª£ÁêÜËÆæÁΩÆÊòØÂê¶Ê≠£Á°Æ\n‚Ä¢ ÁΩëÁªúËøûÊé•ÊòØÂê¶Ê≠£Â∏∏' : 
                    'No available models detected. Please check:\n‚Ä¢ API key validity\n‚Ä¢ Proxy settings\n‚Ä¢ Network connection');
            } finally {
                document.getElementById('loading').classList.add('hidden');
                loadingText.textContent = translations[currentLang]['testing'];
            }
        }

        async function getAvailableModels(apiKey, apiType) {
            switch (apiType) {
                case 'openai':
                    return await getOpenAIModels(apiKey);
                case 'claude':
                    return await getClaudeModels(apiKey);
                case 'gemini':
                    return await getGeminiModels(apiKey);
                default:
                    return [];
            }
        }

        async function getOpenAIModels(apiKey) {
            try {
                const apiUrl = getApiUrl('openai', '/models');
                
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + apiKey,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        return [];
                    }
                    return [];
                }
                
                const data = await response.json();
                
                if (data && data.data && Array.isArray(data.data)) {
                    const models = data.data
                        .filter(model => {
                            const id = model.id.toLowerCase();
                            return (id.includes('gpt') || id.includes('chat')) && 
                                   !id.includes('embed') && 
                                   !id.includes('whisper') && 
                                   !id.includes('tts') &&
                                   !id.includes('dall-e');
                        })
                        .map(model => model.id)
                        .sort();
                    
                    return models;
                }
                return [];
            } catch (error) {
                return [];
            }
        }

        async function getClaudeModels(apiKey) {
            const commonModels = [
                'claude-3-5-sonnet-20241022',
                'claude-3-5-sonnet-20240620', 
                'claude-3-5-haiku-20241022',
                'claude-3-opus-20240229',
                'claude-3-sonnet-20240229',
                'claude-3-haiku-20240307',
            ];
            
            const availableModels = [];
            
            for (const model of commonModels) {
                try {
                    const result = await testClaudeKey(apiKey, model);
                    if (result.valid) {
                        availableModels.push(model);
                    }
                } catch (error) {
                    continue;
                }
            }
            
            return availableModels;
        }

        async function getGeminiModels(apiKey) {
            try {
                const apiUrl = getApiUrl('gemini', '/models?key=' + apiKey);
                
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 400 || response.status === 401 || response.status === 403) {
                        return [];
                    }
                    return [];
                }
                
                const data = await response.json();
                
                if (data && data.models && Array.isArray(data.models)) {
                    const models = data.models
                        .filter(model => {
                            return model.supportedGenerationMethods && 
                                   model.supportedGenerationMethods.includes('generateContent');
                        })
                        .map(model => {
                            return model.name.replace('models/', '');
                        })
                        .sort();
                    
                    return models;
                }
                return [];
            } catch (error) {
                return [];
            }
        }

        async function testOpenAIKey(apiKey, model = null) {
            try {
                const selectedModel = model || getSelectedModel();
                if (!selectedModel) {
                    return { valid: false, error: 'Êú™ÊåáÂÆöÊ®°Âûã', isRateLimit: false };
                }
                
                const apiUrl = getApiUrl('openai', '/chat/completions');
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + apiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: selectedModel,
                        messages: [{ role: 'user', content: 'Hi' }],
                        max_tokens: 1
                    })
                });
                
                if (!response.ok) {
                    if (response.status === 401) return { valid: false, error: 'ËÆ§ËØÅÂ§±Ë¥• (401)', isRateLimit: false };
                    if (response.status === 403) return { valid: false, error: 'ÊùÉÈôê‰∏çË∂≥ (403)', isRateLimit: false };
                    if (response.status === 429) return { valid: false, error: 'Rate Limited (429)', isRateLimit: true };
                    return { valid: false, error: 'HTTP ' + response.status, isRateLimit: response.status === 429 };
                }
                
                const responseText = await response.text();
                if (!responseText || responseText.trim() === '') {
                    return { valid: false, error: 'Á©∫ÂìçÂ∫î', isRateLimit: false };
                }
                
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    return { valid: false, error: 'JSONËß£ÊûêÂ§±Ë¥•', isRateLimit: false };
                }
                
                if (data && data.error) {
                    const errorMessage = data.error.message || data.error.toString();
                    if (errorMessage.toLowerCase().includes('rate limit') || 
                        errorMessage.toLowerCase().includes('too many requests') ||
                        errorMessage.toLowerCase().includes('quota exceeded')) {
                        return { valid: false, error: 'Rate Limited: ' + errorMessage, isRateLimit: true };
                    }
                }
                
                if (data && data.choices && Array.isArray(data.choices)) {
                    return { valid: true, error: null, isRateLimit: false };
                } else {
                    return { valid: false, error: 'ÂìçÂ∫îÊ†ºÂºèÈîôËØØ', isRateLimit: false };
                }
            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    return { valid: false, error: 'ÁΩëÁªúËøûÊé•Â§±Ë¥•', isRateLimit: false };
                }
                return { valid: false, error: 'ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message, isRateLimit: false };
            }
        }
        
        async function testClaudeKey(apiKey, model = null) {
            try {
                const selectedModel = model || getSelectedModel();
                if (!selectedModel) {
                    return { valid: false, error: 'Êú™ÊåáÂÆöÊ®°Âûã', isRateLimit: false };
                }
                
                const apiUrl = getApiUrl('claude', '/messages');
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'x-api-key': apiKey,
                        'Content-Type': 'application/json',
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: selectedModel,
                        max_tokens: 1,
                        messages: [{ role: 'user', content: 'Hi' }]
                    })
                });
                
                if (response.status === 401) return { valid: false, error: 'ËÆ§ËØÅÂ§±Ë¥• (401)', isRateLimit: false };
                if (response.status === 403) return { valid: false, error: 'ÊùÉÈôê‰∏çË∂≥ (403)', isRateLimit: false };
                if (response.status === 429) return { valid: false, error: 'Rate Limited (429)', isRateLimit: true };
                
                const responseText = await response.text();
                
                if (response.status === 400) {
                    try {
                        const errorData = JSON.parse(responseText);
                        if (errorData.error && errorData.error.type === 'authentication_error') {
                            return { valid: false, error: 'ËÆ§ËØÅÈîôËØØ', isRateLimit: false };
                        }
                        if (errorData.error && errorData.error.type === 'rate_limit_error') {
                            return { valid: false, error: 'Rate Limit Error', isRateLimit: true };
                        }
                        if (errorData.error && errorData.error.type === 'invalid_request_error') {
                            return { valid: true, error: null, isRateLimit: false };
                        }
                        return { valid: false, error: 'APIÈîôËØØ: ' + (errorData.error.type || 'unknown'), isRateLimit: false };
                    } catch {
                        return { valid: false, error: 'JSONËß£ÊûêÂ§±Ë¥•', isRateLimit: false };
                    }
                }
                
                if (response.ok) {
                    return { valid: true, error: null, isRateLimit: false };
                } else {
                    return { valid: false, error: 'HTTP ' + response.status, isRateLimit: false };
                }
            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    return { valid: false, error: 'ÁΩëÁªúËøûÊé•Â§±Ë¥•', isRateLimit: false };
                }
                return { valid: false, error: 'ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message, isRateLimit: false };
            }
        }
        
        async function testGeminiKey(apiKey, model = null) {
            try {
                const selectedModel = model || getSelectedModel();
                if (!selectedModel) {
                    return { valid: false, error: 'Êú™ÊåáÂÆöÊ®°Âûã', isRateLimit: false };
                }
                
                const apiUrl = getApiUrl('gemini', '/models/' + selectedModel + ':generateContent?key=' + apiKey);
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [
                            {
                                parts: [
                                    {
                                        text: "Hi"
                                    }
                                ]
                            }
                        ]
                    })
                });
                
                if (!response.ok) {
                    if (response.status === 400) return { valid: false, error: 'APIÂØÜÈí•Êó†Êïà (400)', isRateLimit: false };
                    if (response.status === 401) return { valid: false, error: 'ËÆ§ËØÅÂ§±Ë¥• (401)', isRateLimit: false };
                    if (response.status === 403) return { valid: false, error: 'ÊùÉÈôê‰∏çË∂≥ (403)', isRateLimit: false };
                    if (response.status === 429) return { valid: false, error: 'Rate Limited (429)', isRateLimit: true };
                    return { valid: false, error: 'HTTP ' + response.status, isRateLimit: response.status === 429 };
                }
                
                const responseText = await response.text();
                if (!responseText || responseText.trim() === '') {
                    return { valid: false, error: 'Á©∫ÂìçÂ∫î', isRateLimit: false };
                }
                
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    return { valid: false, error: 'JSONËß£ÊûêÂ§±Ë¥•', isRateLimit: false };
                }
                
                if (data && data.candidates && Array.isArray(data.candidates) && data.candidates.length > 0) {
                    return { valid: true, error: null, isRateLimit: false };
                } else if (data && data.error) {
                    const errorMessage = data.error.message || data.error.toString();
                    if (errorMessage.toLowerCase().includes('quota exceeded') || 
                        errorMessage.toLowerCase().includes('rate limit') ||
                        errorMessage.toLowerCase().includes('too many requests')) {
                        return { valid: false, error: 'Rate Limited: ' + errorMessage, isRateLimit: true };
                    }
                    return { valid: false, error: 'APIÈîôËØØ: ' + errorMessage, isRateLimit: false };
                } else {
                    return { valid: false, error: 'ÂìçÂ∫îÊ†ºÂºèÈîôËØØ', isRateLimit: false };
                }
            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    return { valid: false, error: 'ÁΩëÁªúËøûÊé•Â§±Ë¥•', isRateLimit: false };
                }
                if (error.name === 'SyntaxError' && error.message.includes('JSON')) {
                    return { valid: false, error: 'JSONËß£ÊûêÂ§±Ë¥•', isRateLimit: false };
                }
                return { valid: false, error: 'ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message, isRateLimit: false };
            }
        }

        async function testApiKey(apiKey, apiType) {
            let result;
            switch (apiType) {
                case 'openai':
                    result = await testOpenAIKey(apiKey);
                    break;
                case 'claude':
                    result = await testClaudeKey(apiKey);
                    break;
                case 'gemini':
                    result = await testGeminiKey(apiKey);
                    break;
                default:
                    result = { valid: false, error: '‰∏çÊîØÊåÅÁöÑAPIÁ±ªÂûã', isRateLimit: false };
            }
            
            // ÈÄöÁî®ÁöÑ429ÈîôËØØÊ£ÄÊµã
            if (!result.valid && result.error && (result.error.includes('429') || result.error.includes('ËØ∑Ê±ÇËøáÂ§ö') || result.error.toLowerCase().includes('rate limit') || result.error.toLowerCase().includes('too many requests'))) {
                result.isRateLimit = true;
            }
            
            return result;
        }

        function getLocalizedError(errorKey) {
            if (errorKey && (errorKey.includes('429') || errorKey.includes('Rate Limited') || errorKey.toLowerCase().includes('rate limit'))) {
                if (currentLang === 'zh') {
                    if (errorKey.includes('Rate Limited (429)')) {
                        return 'ÈÄüÁéáÈôêÂà∂ (429)';
                    } else if (errorKey.includes('Rate Limited')) {
                        return 'ÈÄüÁéáÈôêÂà∂';
                    } else if (errorKey.includes('429')) {
                        return 'ÈÄüÁéáÈôêÂà∂ (429)';
                    }
                    return 'ÈÄüÁéáÈôêÂà∂';
                } else {
                    return errorKey;
                }
            }
            
            const errorMap = {
                'ËÆ§ËØÅÂ§±Ë¥• (401)': currentLang === 'zh' ? 'ËÆ§ËØÅÂ§±Ë¥• (401)' : 'Auth Failed (401)',
                'ÊùÉÈôê‰∏çË∂≥ (403)': currentLang === 'zh' ? 'ÊùÉÈôê‰∏çË∂≥ (403)' : 'Permission Denied (403)',
                'ËØ∑Ê±ÇËøáÂ§ö (429)': currentLang === 'zh' ? 'ËØ∑Ê±ÇËøáÂ§ö (429)' : 'Too Many Requests (429)',
                'Rate Limited (429)': currentLang === 'zh' ? 'ÈÄüÁéáÈôêÂà∂ (429)' : 'Rate Limited (429)',
                'ÁΩëÁªúËøûÊé•Â§±Ë¥•': currentLang === 'zh' ? 'ÁΩëÁªúËøûÊé•Â§±Ë¥•' : 'Network Connection Failed',
                'JSONËß£ÊûêÂ§±Ë¥•': currentLang === 'zh' ? 'JSONËß£ÊûêÂ§±Ë¥•' : 'JSON Parse Failed',
                'Á©∫ÂìçÂ∫î': currentLang === 'zh' ? 'Á©∫ÂìçÂ∫î' : 'Empty Response',
                'ÂìçÂ∫îÊ†ºÂºèÈîôËØØ': currentLang === 'zh' ? 'ÂìçÂ∫îÊ†ºÂºèÈîôËØØ' : 'Invalid Response Format',
                'ËÆ§ËØÅÈîôËØØ': currentLang === 'zh' ? 'ËÆ§ËØÅÈîôËØØ' : 'Authentication Error',
                'Êú™ÊåáÂÆöÊ®°Âûã': currentLang === 'zh' ? 'Êú™ÊåáÂÆöÊ®°Âûã' : 'No Model Specified',
                'APIÂØÜÈí•Êó†Êïà (400)': currentLang === 'zh' ? 'APIÂØÜÈí•Êó†Êïà (400)' : 'Invalid API Key (400)',
                'ÊµãËØïÂºÇÂ∏∏': currentLang === 'zh' ? 'ÊµãËØïÂºÇÂ∏∏' : 'Test Exception',
                'ÈáçËØïÂ§±Ë¥•': currentLang === 'zh' ? 'ÈáçËØïÂ§±Ë¥•' : 'Retry Failed',
                '‰∏çÊîØÊåÅÁöÑAPIÁ±ªÂûã': currentLang === 'zh' ? '‰∏çÊîØÊåÅÁöÑAPIÁ±ªÂûã' : 'Unsupported API Type'
            };
            
            if (errorMap[errorKey]) {
                return errorMap[errorKey];
            }
            
            if (errorKey && errorKey.startsWith('APIÈîôËØØ:')) {
                const detail = errorKey.replace('APIÈîôËØØ:', '').trim();
                return currentLang === 'zh' ? 'APIÈîôËØØ: ' + detail : 'API Error: ' + detail;
            }
            
            if (errorKey && errorKey.startsWith('ËØ∑Ê±ÇÂ§±Ë¥•:')) {
                const detail = errorKey.replace('ËØ∑Ê±ÇÂ§±Ë¥•:', '').trim();
                return currentLang === 'zh' ? 'ËØ∑Ê±ÇÂ§±Ë¥•: ' + detail : 'Request Failed: ' + detail;
            }
            
            if (errorKey && errorKey.startsWith('ÊµãËØïÂºÇÂ∏∏:')) {
                const detail = errorKey.replace('ÊµãËØïÂºÇÂ∏∏:', '').trim();
                return currentLang === 'zh' ? 'ÊµãËØïÂºÇÂ∏∏: ' + detail : 'Test Exception: ' + detail;
            }
            
            if (errorKey && errorKey.startsWith('Rate Limited:')) {
                if (currentLang === 'zh') {
                    const detail = errorKey.replace('Rate Limited:', '').trim();
                    return 'ÈÄüÁéáÈôêÂà∂: ' + detail;
                } else {
                    return errorKey;
                }
            }
            
            if (errorKey && errorKey.includes('HTTP ')) {
                return errorKey;
            }
            
            if (errorKey && errorKey.includes('(') && errorKey.includes(')')) {
                const match = errorKey.match(/^(.+?)\s*\((\d{3})\)$/);
                if (match) {
                    const errorText = match[1];
                    const statusCode = match[2];
                    
                    const errorTextMap = {
                        'APIÂØÜÈí•Êó†Êïà': currentLang === 'zh' ? 'APIÂØÜÈí•Êó†Êïà' : 'Invalid API Key',
                        'ËÆ§ËØÅÂ§±Ë¥•': currentLang === 'zh' ? 'ËÆ§ËØÅÂ§±Ë¥•' : 'Auth Failed',
                        'ÊùÉÈôê‰∏çË∂≥': currentLang === 'zh' ? 'ÊùÉÈôê‰∏çË∂≥' : 'Permission Denied',
                        'ËØ∑Ê±ÇËøáÂ§ö': currentLang === 'zh' ? 'ËØ∑Ê±ÇËøáÂ§ö' : 'Too Many Requests'
                    };
                    
                    const translatedText = errorTextMap[errorText] || errorText;
                    return `${translatedText} (${statusCode})`;
                }
            }
            
            return errorKey || (currentLang === 'zh' ? 'Êú™Áü•ÈîôËØØ' : 'Unknown Error');
        }

        function deduplicateAndCleanKeys(keys) {
            const seen = new Set();
            const uniqueKeys = [];
            const duplicates = [];
            
            keys.forEach(key => {
                const cleanKey = key.trim();
                if (cleanKey && !seen.has(cleanKey)) {
                    seen.add(cleanKey);
                    uniqueKeys.push(cleanKey);
                } else if (cleanKey && seen.has(cleanKey)) {
                    duplicates.push(cleanKey);
                }
            });
            
            return { uniqueKeys, duplicates };
        }
        
        function updateStats() {
            const validKeys = allKeysData.filter(k => k.status === 'valid');
            const invalidKeys = allKeysData.filter(k => k.status === 'invalid'); 
            const rateLimitedKeys = allKeysData.filter(k => k.status === 'rate-limited');
            const testingKeys = allKeysData.filter(k => k.status === 'testing');
            const retryingKeys = allKeysData.filter(k => k.status === 'retrying');
            const pendingKeys = allKeysData.filter(k => k.status === 'pending');
            
            document.getElementById('totalCount').textContent = allKeysData.length;
            document.getElementById('validCount').textContent = validKeys.length;
            document.getElementById('invalidCount').textContent = invalidKeys.length;
            document.getElementById('rateLimitedCount').textContent = rateLimitedKeys.length;
            document.getElementById('testingCount').textContent = testingKeys.length + pendingKeys.length;
            document.getElementById('retryingCount').textContent = retryingKeys.length;
        }
        
        function updateKeyLists() {
            const validKeys = allKeysData.filter(k => k.status === 'valid');
            const invalidKeys = allKeysData.filter(k => k.status === 'invalid');
            const rateLimitedKeys = allKeysData.filter(k => k.status === 'rate-limited');
            
            updateKeyList('allKeys', allKeysData);
            updateKeyList('validKeys', validKeys);
            updateKeyList('invalidKeys', invalidKeys);
            updateKeyList('rateLimitedKeys', rateLimitedKeys);
        }
        
        function updateKeyList(elementId, keys) {
            const container = document.getElementById(elementId);
            if (!container) {
                return;
            }
            
            container.innerHTML = '';
            
            if (keys.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                
                let emptyMessage = '';
                switch (elementId) {
                    case 'allKeys':
                        emptyMessage = currentLang === 'zh' ? 'ÊöÇÊó†ÂØÜÈí•' : 'No keys';
                        break;
                    case 'validKeys':
                        emptyMessage = currentLang === 'zh' ? 'ÊöÇÊó†ÊúâÊïàÂØÜÈí•' : 'No valid keys';
                        break;
                    case 'invalidKeys':
                        emptyMessage = currentLang === 'zh' ? 'ÊöÇÊó†Êó†ÊïàÂØÜÈí•' : 'No invalid keys';
                        break;
                    case 'rateLimitedKeys':
                        emptyMessage = currentLang === 'zh' ? 'ÊöÇÊó†ÈÄüÁéáÈôêÂà∂ÂØÜÈí•' : 'No rate limited keys';
                        break;
                    default:
                        emptyMessage = currentLang === 'zh' ? 'ÊöÇÊó†Êï∞ÊçÆ' : 'No data';
                }
                
                emptyState.innerHTML = `
                    <div class="empty-icon">üì≠</div>
                    <div class="empty-text">${emptyMessage}</div>
                `;
                
                container.appendChild(emptyState);
                return;
            }
            
            keys.forEach(keyData => {
                const keyItem = document.createElement('div');
                keyItem.className = 'key-item';
                
                const statusClass = keyData.status === 'valid' ? 'status-valid' : 
                                   keyData.status === 'invalid' ? 'status-invalid' : 
                                   keyData.status === 'rate-limited' ? 'status-rate-limited' : 
                                   keyData.status === 'retrying' ? 'status-retrying' : 'status-testing';
                
                const statusText = translations[currentLang]['status-' + keyData.status] || keyData.status;
                
                let errorDisplay = '';
                if ((keyData.status === 'invalid' || keyData.status === 'rate-limited') && keyData.error) {
                    const localizedError = getLocalizedError(keyData.error);
                    const errorColor = keyData.status === 'rate-limited' ? '#856404' : '#dc3545';
                    errorDisplay = '<div style="font-size: 11px; color: ' + errorColor + '; margin-top: 2px;">' + localizedError + '</div>';
                }

                let modelDisplay = '';
                if (keyData.model) {
                    modelDisplay = '<div style="font-size: 11px; color: #6c757d; margin-top: 2px;">Model: ' + keyData.model + '</div>';
                }

                let retryDisplay = '';
                if (keyData.retryCount && keyData.retryCount > 0) {
                    const retryText = currentLang === 'zh' ? 'ÈáçËØï' : 'Retry';
                    retryDisplay = '<div style="font-size: 11px; color: #f39c12; margin-top: 2px;">' + retryText + ': ' + keyData.retryCount + '</div>';
                }
                
                keyItem.innerHTML = '<div class="key-text">' + keyData.key + modelDisplay + errorDisplay + retryDisplay + '</div><div class="key-status ' + statusClass + '">' + statusText + '</div>';
                
                container.appendChild(keyItem);
            });
        }
        
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            const tabButton = document.querySelector(`[data-tab="${tab}"]`);
            let tabContentId = tab + 'Tab';
            if (tab === 'rate-limited') {
                tabContentId = 'rateLimitedTab';
            }
            const tabContent = document.getElementById(tabContentId);
            
            if (tabButton) {
                tabButton.classList.add('active');
            }
            if (tabContent) {
                tabContent.classList.add('active');
            }
        }
        
        function copyKeys(type) {
            let keysToCopy = [];
            
            switch (type) {
                case 'all':
                    keysToCopy = allKeysData.map(k => k.key);
                    break;
                case 'valid':
                    keysToCopy = allKeysData.filter(k => k.status === 'valid').map(k => k.key);
                    break;
                case 'invalid':
                    keysToCopy = allKeysData.filter(k => k.status === 'invalid').map(k => k.key);
                    break;
                case 'rate-limited':
                    keysToCopy = allKeysData.filter(k => k.status === 'rate-limited').map(k => k.key);
                    break;
            }
            
            if (keysToCopy.length === 0) {
                const message = currentLang === 'zh' ? 'Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑÂØÜÈí•ÔºÅ' : 'No keys to copy!';
                alert(message);
                return;
            }
            
            navigator.clipboard.writeText(keysToCopy.join('\n')).then(() => {
                const message = currentLang === 'zh' ? 
                    'Â∑≤Â§çÂà∂ ' + keysToCopy.length + ' ‰∏™ÂØÜÈí•Âà∞Ââ™Ë¥¥ÊùøÔºÅ' : 
                    'Copied ' + keysToCopy.length + ' keys to clipboard!';
                alert(message);
            }).catch(err => {
                // Â§çÂà∂Â§±Ë¥•Êó∂ÁöÑÂ§áÁî®ÊñπÊ°à
                const textArea = document.createElement('textarea');
                textArea.value = keysToCopy.join('\n');
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                const message = currentLang === 'zh' ? 
                    'Â∑≤Â§çÂà∂ ' + keysToCopy.length + ' ‰∏™ÂØÜÈí•Âà∞Ââ™Ë¥¥ÊùøÔºÅ' : 
                    'Copied ' + keysToCopy.length + ' keys to clipboard!';
                alert(message);
            });
        }
        
        function deduplicateKeys() {
            const apiKeysText = document.getElementById('apiKeys').value.trim();
            
            if (!apiKeysText) {
                alert(currentLang === 'zh' ? 'ËØ∑ÂÖàËæìÂÖ•APIÂØÜÈí•ÔºÅ' : 'Please enter API keys first!');
                return;
            }
            
            const rawKeys = apiKeysText.split('\n').filter(key => key.trim());
            const { uniqueKeys, duplicates } = deduplicateAndCleanKeys(rawKeys);
            
            if (duplicates.length > 0) {
                document.getElementById('apiKeys').value = uniqueKeys.join('\n');
                
                const message = currentLang === 'zh' ? 
                    `Â∑≤ÂéªÈô§ ${duplicates.length} ‰∏™ÈáçÂ§çÂØÜÈí•Ôºå‰øùÁïô ${uniqueKeys.length} ‰∏™ÂîØ‰∏ÄÂØÜÈí•„ÄÇ` :
                    `Removed ${duplicates.length} duplicate keys, kept ${uniqueKeys.length} unique keys.`;
                alert(message);
            } else {
                const message = currentLang === 'zh' ? 
                    'Êú™ÂèëÁé∞ÈáçÂ§çÂØÜÈí•„ÄÇ' :
                    'No duplicate keys found.';
                alert(message);
            }
        }
        
        function clearAll() {
            if (isTestingInProgress) {
                const message = currentLang === 'zh' ? 'ÊµãËØïÊ≠£Âú®ËøõË°å‰∏≠ÔºåÊó†Ê≥ïÊ∏ÖÁ©∫ÔºÅ' : 'Testing in progress, cannot clear!';
                alert(message);
                return;
            }
            
            document.getElementById('apiKeys').value = '';
            document.getElementById('modelInput').value = '';
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('progressBar').classList.add('hidden');
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('detectedModels').style.display = 'none';
            
            allKeysData = [];
            detectedModels.clear();
            completedCount = 0;
            totalCount = 0;
            
            updateStats();
            updateKeyLists();
            
            showTab('all');
        }

        function initializeEventListeners() {
            document.getElementById('langBtn').addEventListener('click', toggleLanguage);
            document.getElementById('themeBtn').addEventListener('click', toggleTheme);
            document.getElementById('apiType').addEventListener('change', updateProxyPlaceholder);
            document.getElementById('modelToggleBtn').addEventListener('click', toggleModelInput);
            document.getElementById('detectedModelsHeader').addEventListener('click', toggleModelList);
            document.getElementById('detectBtn').addEventListener('click', detectModels);
            document.getElementById('startBtn').addEventListener('click', startTesting);
            document.getElementById('dedupeBtn').addEventListener('click', deduplicateKeys);
            document.getElementById('clearBtn').addEventListener('click', clearAll);
            
            document.querySelectorAll('[data-tab]').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    showTab(e.target.getAttribute('data-tab'));
                });
            });
            
            document.querySelectorAll('[data-copy]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    copyKeys(e.target.getAttribute('data-copy'));
                });
            });
        }

        function handleResize() {
            if (window.innerWidth <= 768) {
                const keyLists = document.querySelectorAll('.key-list');
                keyLists.forEach(list => {
                    const maxHeight = Math.min(300, window.innerHeight * 0.4);
                    list.style.maxHeight = maxHeight + 'px';
                });
            }
        }

        function initialize() {
            updateProxyPlaceholder();
            updateLanguage();
            initializeEventListeners();
            initConcurrencyControls();
            initRetryControls();
            
            window.addEventListener('resize', handleResize);
            window.addEventListener('orientationchange', () => {
                setTimeout(handleResize, 100);
            });
            
            handleResize();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }
    </script>
</body>
</html>